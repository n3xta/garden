<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Garden</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three-gltf-loader@1.111.0/index.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.9/Tone.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/DragControls.js"></script>


  <link rel="stylesheet" href="/css/garden.css">
</head>

<body>
  <!-- Back to Home button in the top left corner -->
  <a href="/">
    <img src="/2dassets/back.png" class="back-button" alt="Back to Home">
  </a>
  
  <!-- Explore button -->
  <a href="/explore">
    <img src="/2dassets/explore.png" class="explore-button" alt="Explore">
  </a>

  <!-- Save button (only show if not in read-only mode) -->
  <% if (!locals.isReadOnly) { %>
  <a href="#" id="save-button">
    <img src="/2dassets/save.png" class="save-button" alt="Save Garden">
  </a>
  <% } %>

  <!-- Read-only mode banner (only show in read-only mode) -->
  <% if (locals.isReadOnly) { %>
  <div class="readonly-banner">
    <p>Viewing <strong><%= user.username %>'s</strong> garden</p>
    <% if (locals.visitorName) { %>
    <a href="/mygarden" class="my-garden-link">Back to My Garden</a>
    <% } %>
  </div>
  <% } %>

  <div id="three-container"></div>

  <div class="controls">
    <button id="play-button">PLAY</button>
    <input type="range" id="tempo-slider" min="40" max="240" value="80">
    <% if (!locals.isReadOnly) { %>
    <button id="random-note">PLANT A RANDOM NOTE</button>
    <% } %>
  </div>

  <!-- Store garden data in a hidden element -->
  <div id="garden-data" style="display: none;" 
       data-garden='<%- JSON.stringify(gardenData || { plants: [], tempo: 80 }) %>'
       data-readonly='<%= locals.isReadOnly ? "true" : "false" %>'></div>
  
  <!-- Retrieve garden data with regular JavaScript -->
  <script>
    const gardenDataElement = document.getElementById('garden-data');
    const initialGardenData = JSON.parse(gardenDataElement.getAttribute('data-garden'));
    const isReadOnly = gardenDataElement.getAttribute('data-readonly') === 'true';
  </script>

  <!-- Saved Notification -->
  <div id="save-notification" class="save-notification">Saved!</div>

  <script src="/js/garden.js"></script>

</body>
</html>